{% extends 'blog/base.html' %}

{% block title %}
    {% if form.instance.pk %}Edit Post{% else %}New Post{% endif %} - Django Blog
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">
                    {% if form.instance.pk %}
                        <i class="fas fa-edit"></i> Edit Post: "{{ form.instance.title }}"
                    {% else %}
                        <i class="fas fa-plus"></i> Write a New Blog Post
                    {% endif %}
                </h3>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {{ form.non_field_errors }}
                        </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <label for="{{ form.title.id_for_label }}" class="form-label">
                            Title <span class="text-danger">*</span>
                        </label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.title.errors }}
                            </div>
                        {% endif %}
                        {% if form.title.help_text %}
                            <div class="form-text">{{ form.title.help_text }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.content.id_for_label }}" class="form-label">
                            Content <span class="text-danger">*</span>
                        </label>
                        {{ form.content }}
                        {% if form.content.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.content.errors }}
                            </div>
                        {% endif %}
                        {% if form.content.help_text %}
                            <div class="form-text">{{ form.content.help_text }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.tags.id_for_label }}" class="form-label">
                            Tags
                        </label>
                        {{ form.tags }}
                        {% if form.tags.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.tags.errors }}
                            </div>
                        {% endif %}
                        {% if form.tags.help_text %}
                            <div class="form-text">{{ form.tags.help_text }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    {% if form.instance.pk %}
                                        <i class="fas fa-save"></i> Update Post
                                    {% else %}
                                        <i class="fas fa-plus"></i> Publish Post
                                    {% endif %}
                                </button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-grid">
                                {% if form.instance.pk %}
                                    <a href="{% url 'blog:post_detail' form.instance.pk %}" class="btn btn-secondary">
                                        <i class="fas fa-times"></i> Cancel
                                    </a>
                                {% else %}
                                    <a href="{% url 'blog:posts' %}" class="btn btn-secondary">
                                        <i class="fas fa-times"></i> Cancel
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Writing Tips -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Writing Tips</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Content Guidelines:</h6>
                        <ul class="small">
                            <li>Write a clear, descriptive title</li>
                            <li>Start with an engaging introduction</li>
                            <li>Use paragraphs to organize your thoughts</li>
                            <li>Include examples or personal experiences</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Formatting Tips:</h6>
                        <ul class="small">
                            <li>Use line breaks to separate paragraphs</li>
                            <li>Keep sentences concise and clear</li>
                            <li>Proofread before publishing</li>
                            <li>Aim for at least 20 characters of content</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Auto-save draft functionality (could be enhanced with AJAX)
document.addEventListener('DOMContentLoaded', function() {
    const titleField = document.getElementById('{{ form.title.id_for_label }}');
    const contentField = document.getElementById('{{ form.content.id_for_label }}');
    
    // Character counter for title
    if (titleField) {
        const titleCounter = document.createElement('small');
        titleCounter.className = 'text-muted';
        titleField.parentNode.appendChild(titleCounter);
        
        function updateTitleCounter() {
            const remaining = 200 - titleField.value.length;
            titleCounter.textContent = `${titleField.value.length}/200 characters`;
            titleCounter.className = remaining < 20 ? 'text-warning' : remaining < 0 ? 'text-danger' : 'text-muted';
        }
        
        titleField.addEventListener('input', updateTitleCounter);
        updateTitleCounter();
    }
    
    // Word counter for content
    if (contentField) {
        const contentCounter = document.createElement('small');
        contentCounter.className = 'text-muted';
        contentField.parentNode.appendChild(contentCounter);
        
        function updateContentCounter() {
            const wordCount = contentField.value.split(/\s+/).filter(word => word.length > 0).length;
            contentCounter.textContent = `${wordCount} words`;
        }
        
        contentField.addEventListener('input', updateContentCounter);
        updateContentCounter();
    }
});
</script>
{% endblock %}
